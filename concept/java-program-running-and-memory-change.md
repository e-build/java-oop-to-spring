***목차***
- [개요](#개요)
- [main() 메서드와 메서드 스택 프레임](#main()-메서드와-메서드-스택-프레임)
- [변수와 메모리](#변수와-메모리)
    + [지역 변수와 메모리](#지역-변수와-메모리)
    + [블록 구문과 메모리](#블록-구문과-메모리)
    + [전역 변수와 메모리](#전역-변수와-메모리)
- [메서드와 메모리](#메서드와-메모리)
    
- [멀티 스레드와 멀티 프로세스의 이해](#멀티-스레드와-멀티-프로세스의-이해)

### 학습목표
> 1. 자바에서 지역변수, 전역변수, 멤버변수가 메모리의 어느 영역에 어떻게 저장되고 소멸되는지 이해한다. 
> 2. 메서드에 호출에 따른 메모리의 변화를 이해한다.


# 개요 
자바 프로그램이 어떻게 개발되고 구동되는 지를 알기 위해서는 JVM(Java Virual Machine)의 존재와 역할을 아는 것이 필수적이다. 먼저 "자바라는 언어를 활용하여 프로그램을 개발한다는 것"은 JDK(Java Development Kit)라고 하는 JVM용 소프트웨어 개발도구를 활용하여 프로그래밍하는 것을 의미한다. JVM은 이름 그대로 가상기계이며, 자바프로그램은 JVM 이라고 하는 가상의 컴퓨터 위에서 실행되는 JRE(Java Runtime Environment) 라는 JVM용 운영체제를 통해 실행되는 것이다.

이와 같은 연관관계를 고려했을 때, JVM, JRE, JDK 라고 하는 각각의 배포판들 끼리의 버전 충돌을 피하고 통합적으로 관리되어야 하는 편의를 위해, 일반적으로 JDK가 JRE를 포함하고 다시 JRE는 JVM을 포함하는 형태로 배포된다.

자바가 메모리를 어떻게 활용하는 지에 대한 학습 이전에 프로그래밍 영역의 모든 프로그램들이 메모리를 사용하는 공통된 방식에 대하여 알아보자.
일반적으로 프로그램은 "코드를 실행하는 영역"과 "데이터를 저장하는 영역"으로 구분하여 메모리를 사용한다. 운영체제나 언어 자체를 개발하는 로우 레벨 개발자가 아닌 이상 애플리케이션 영역의 개발자가 코드 실행영역을 깊게 학습할 필요는 없다. 그래서 데이터 저장 영역의 삼분할 구조만 살펴볼 것이다. 데이터 저장 영역은 다시 다음과 같이 세 가지 영역으로 구분할 수 있다.

- 스태틱(static) 영역 : 클래스들의 놀이터
- 스택(stack) 영역 : 메서드들의 놀이터
- 힙(heap) 영역 : 객체들의 놀이터

# main() 메서드와 메서드 스택 프레임

main() 메서드는 프로그램이 실행되는 시작점이다. main() 메서드가 실행될 때 메모리에서 발생하는 일들을 대략적인 순서로 정리하면 다음과 같다.

1. JRE는 먼저 프로그램 안에 main() 메서드가 있는 지 확인한다.
2. main()메서드의 존재가 확인되면 RE는 프로그램 실행을 위해 JVM을 부팅한다.
3. 부팅된 JVM은 목적파일을 받아 그 목적파일을 실행한다.
    - 목적파일을 실행하기 이전에 JVM이 수행하는 전처리 과정이 존재한다. 우선 java.lang 패키지를 메모리의 스태틱 영역에 로딩시켜 놓는다. 그 다음 개발자가 작성한 모든 클래스와 import 패키지를 스태틱 영역에 가져다 놓는다.
4. main() 메서드가 실행될 스택 프레임(stack frame)이 스택 영역에 할당된다.
    - 정확히 이야기하면, 여는 중괄호 "{" 를 만날 때마다 스택 프레임이 하나씩 생긴다.(클래스 수준의 중괄호 제외)
    - 이후 닫는 중괄호 "}"를 만나면 스택 프레임이 소멸된다.
5. 메서드의 인자 args를 저장할 변수공간을 스택 프레임의 맨 밑에 확보한다.
6. main() 메서드 안의 명령문을 차례대로 수행한다.
7. main() 메서드는 프로그램의 시작점이자 끝이기도 하기 때문에, main() 메서드가 끝나면 JRE는 JVM을 종료하고 JRE 자체도 운영체제 상의 메모리에서 사라진다.

# 변수와 메모리
자바에서 변수를 할당함에 따라 메모리의 static, stack, heap 영역에 어떤 변화가 생기는 지 알아본다.
### 지역 변수와 메모리
흔히 지역변수라고 하는 것은 메서드내에서 혹은 중괄호로 둘러싼 블럭 내에서 선언된 변수를 의미한다. 반드시 변수의 범위가 지역적으로 정해져 있기 때문에, 그 범위를 넘어가서는 사용될 수 없다. 
```
public class MemoryCheck {
    public static void main(String[] args){
        int var1;
        var1 = 10;
        
        double var2 = 2.0;
    }
}
```
위와 같은 main() 메서드 내에서 변수가 선언되고 값이 할당됨에 따라 메모리에 나타나는 변화는 다음과 같다.
1. var1 선언
   * 메모리의 스택영역에 할당된 main()메서드의 스택프레임에 4바이트 크기의 정수 저장공간이 마련된다.
    * 마련된 저장공간에는 어떤값이 들어있는 지 알 수 없다. 아직 초기화되지 않았기 때문에 이전에 해당 공간의 메모리를 사용했던 다른 프로그램이 청소하지 않고 간 값을 그대로 가지고 있을 수도 있다.
2. var1에 값 할당
    * 값을 할당하는 순간 var1의 메모리의 공간에 10이 저장된다.
3. var2 선언 및 할당
    * double 타입에 크기(8바이트)에 맞는 메모리공간이 생성되고, 2.0이 저장된다.
4. main() 메서드가 종료되는 } 를 만났을 때, main() 메서드의 스택프레임이 스택영역에서 사라진다. 

즉, 지역변수에 대한 설명과 함께 언급했던 것처럼 변수의 범위가 지역적으로 정해져 있다는 것은, 스택영역 내에 특정 스택프레임안의 메모리공간이 할당되었다는 것이고, 이는 스택영역내에서 서로 다른 스택프레임의 
메모리에 접근할 수 없다는 것을 의미한다.
### 블록 구문과 메모리
```
public class MemoryCheck {
    public static void main(String[] args){
        int var1 = 10;
        int var2 = 20;
        
        if(var1 == 10){
            int v_1 = var2 + 5;
            var2 = v_1;
        } else {
            int v_2 = var2 + 5;
            var2 = v_2;
        }
    }
}
```
여는 중괄호를 만나면 스택프레임이 시작된다고 했었다. 따라서, 위와 같은 경우 스택프레임의 생성 및 소멸 순서를 고려해보면 다음과 같다.
1. main() 메서드 스택프레임 생성
2. main() 메서드 스택프레임 내에 var1, var2 지역변수 메모리 공간 생성
3. var1==10 이 true 이기 때문에 main()메서드 스택프레임 내에서 if 블록의 스택프레임이 중첩되어 생성.
4. if 블록의 스택프레임 내의 v_1 의 지역변수 메모리 공간 생성
5. if 블록의 스택프레임에서 상위 스택프레임에 접근하여 var2 에 값 할당
6. if문 종료와 함께 스택프레임 소멸
7. main() 메서드 스택프레임 소멸

위와 같은 과정을 통해서 우리는 세 가지 사실을 알 수 있다. 첫 번째로 아예 실행되지 않은 else문은 스택 프레임이 생성되지 않았다. 두 번째는 스택프레임의 소멸과 함께 지역변수를 위한 메모리공간도 소멸된다는 것이다.
마지막으로 세번째는 중첩된 내부 스택프레임의 변수에서 외부 스택프레임의 변수에 접근하는 것은 가능하나 그 역은 불가능하다는 것이다.

### 전역 변수와 메모리

# 메서드와 메모리




# 멀티 스레드와 멀티 프로세스의 이해